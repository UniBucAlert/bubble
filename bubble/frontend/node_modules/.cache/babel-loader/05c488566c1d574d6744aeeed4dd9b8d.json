{"ast":null,"code":"/**\n * Fork of the https://github.com/ignatevdev/final-form-submit-errors\n *\n * In react-admin, errors might be objects with `message` and `args` properties which\n * are used for translation.\n * The original final-form-submit-errors mutator was considering those errors as form\n * nested field like `name.message` and `name.args`.\n * This version detects those objects.\n */\nexport function resetSubmitErrors(_a, state, _b) {\n  var _c = _a[0],\n      prev = _c.prev,\n      current = _c.current;\n  var getIn = _b.getIn,\n      setIn = _b.setIn; // Reset the general submit error on any value change\n\n  if (state.formState.submitError) {\n    delete state.formState.submitError;\n  }\n\n  if (!isObjectEmpty(state.formState.submitErrors)) {\n    // Flatten nested errors object for easier comparison\n    var flatErrors = flatten(state.formState.submitErrors);\n    var changed_1 = []; // Iterate over each error\n\n    Object.keys(flatErrors).forEach(function (key) {\n      // Compare the value for the error field path\n      if (getIn(prev, key) !== getIn(current, key)) {\n        changed_1.push(key);\n      }\n    }); // Reset the error on value change\n\n    if (changed_1.length) {\n      var newErrors_1 = state.formState.submitErrors;\n      changed_1.forEach(function (key) {\n        newErrors_1 = setIn(newErrors_1, key, null);\n      }); // Clear submit errors from empty objects and arrays\n\n      var cleanErrors = clean(newErrors_1);\n      state.formState.submitErrors = cleanErrors;\n    }\n  }\n}\nexport function clean(obj) {\n  var newObj = Array.isArray(obj) ? [] : {};\n  Object.keys(obj).forEach(function (key) {\n    if (obj[key] && typeof obj[key] === 'object') {\n      var newVal = clean(obj[key]);\n\n      if (!isObjectEmpty(newVal) && newVal.length !== 0) {\n        newObj[key] = newVal;\n      }\n    } else if (obj[key] !== null) {\n      newObj[key] = obj[key];\n    }\n  });\n  return newObj;\n}\nexport function flatten(obj) {\n  var toReturn = {};\n\n  for (var i in obj) {\n    if (!obj.hasOwnProperty(i)) {\n      continue;\n    }\n\n    if (typeof obj[i] === 'object' && obj[i] !== null && !isValidationError(obj[i])) {\n      var flatObject = flatten(obj[i]);\n\n      for (var x in flatObject) {\n        if (!flatObject.hasOwnProperty(x)) {\n          continue;\n        } // Make a bracket array notation like some[1].array[0]\n\n\n        var key = (i + \".\" + x).split('.').reduce(function (str, value) {\n          if (/^\\[\\d\\]/.test(value)) {\n            return \"\" + str + value;\n          }\n\n          if (!isNaN(Number(value))) {\n            return str + \"[\" + value + \"]\";\n          }\n\n          if (str) {\n            return str + \".\" + value;\n          }\n\n          return value;\n        }, '');\n        toReturn[key] = flatObject[x];\n      }\n    } else {\n      toReturn[i] = obj[i];\n    }\n  }\n\n  return toReturn;\n}\nexport var isValidationError = function (obj) {\n  return obj.message && obj.args;\n};\nexport function isObjectEmpty(obj) {\n  if (!obj) {\n    return true;\n  }\n\n  return Object.entries(obj).length === 0 && obj.constructor === Object;\n}\nexport default {\n  resetSubmitErrors: resetSubmitErrors\n};","map":{"version":3,"sources":["/node_modules/ra-core/esm/form/submitErrorsMutators.js"],"names":["resetSubmitErrors","_a","state","_b","_c","prev","current","getIn","setIn","formState","submitError","isObjectEmpty","submitErrors","flatErrors","flatten","changed_1","Object","keys","forEach","key","push","length","newErrors_1","cleanErrors","clean","obj","newObj","Array","isArray","newVal","toReturn","i","hasOwnProperty","isValidationError","flatObject","x","split","reduce","str","value","test","isNaN","Number","message","args","entries","constructor"],"mappings":"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","sourcesContent":["/**\n * Fork of the https://github.com/ignatevdev/final-form-submit-errors\n *\n * In react-admin, errors might be objects with `message` and `args` properties which\n * are used for translation.\n * The original final-form-submit-errors mutator was considering those errors as form\n * nested field like `name.message` and `name.args`.\n * This version detects those objects.\n */\nexport function resetSubmitErrors(_a, state, _b) {\n    var _c = _a[0], prev = _c.prev, current = _c.current;\n    var getIn = _b.getIn, setIn = _b.setIn;\n    // Reset the general submit error on any value change\n    if (state.formState.submitError) {\n        delete state.formState.submitError;\n    }\n    if (!isObjectEmpty(state.formState.submitErrors)) {\n        // Flatten nested errors object for easier comparison\n        var flatErrors = flatten(state.formState.submitErrors);\n        var changed_1 = [];\n        // Iterate over each error\n        Object.keys(flatErrors).forEach(function (key) {\n            // Compare the value for the error field path\n            if (getIn(prev, key) !== getIn(current, key)) {\n                changed_1.push(key);\n            }\n        });\n        // Reset the error on value change\n        if (changed_1.length) {\n            var newErrors_1 = state.formState.submitErrors;\n            changed_1.forEach(function (key) {\n                newErrors_1 = setIn(newErrors_1, key, null);\n            });\n            // Clear submit errors from empty objects and arrays\n            var cleanErrors = clean(newErrors_1);\n            state.formState.submitErrors = cleanErrors;\n        }\n    }\n}\nexport function clean(obj) {\n    var newObj = Array.isArray(obj) ? [] : {};\n    Object.keys(obj).forEach(function (key) {\n        if (obj[key] && typeof obj[key] === 'object') {\n            var newVal = clean(obj[key]);\n            if (!isObjectEmpty(newVal) && newVal.length !== 0) {\n                newObj[key] = newVal;\n            }\n        }\n        else if (obj[key] !== null) {\n            newObj[key] = obj[key];\n        }\n    });\n    return newObj;\n}\nexport function flatten(obj) {\n    var toReturn = {};\n    for (var i in obj) {\n        if (!obj.hasOwnProperty(i)) {\n            continue;\n        }\n        if (typeof obj[i] === 'object' &&\n            obj[i] !== null &&\n            !isValidationError(obj[i])) {\n            var flatObject = flatten(obj[i]);\n            for (var x in flatObject) {\n                if (!flatObject.hasOwnProperty(x)) {\n                    continue;\n                }\n                // Make a bracket array notation like some[1].array[0]\n                var key = (i + \".\" + x).split('.').reduce(function (str, value) {\n                    if (/^\\[\\d\\]/.test(value)) {\n                        return \"\" + str + value;\n                    }\n                    if (!isNaN(Number(value))) {\n                        return str + \"[\" + value + \"]\";\n                    }\n                    if (str) {\n                        return str + \".\" + value;\n                    }\n                    return value;\n                }, '');\n                toReturn[key] = flatObject[x];\n            }\n        }\n        else {\n            toReturn[i] = obj[i];\n        }\n    }\n    return toReturn;\n}\nexport var isValidationError = function (obj) { return obj.message && obj.args; };\nexport function isObjectEmpty(obj) {\n    if (!obj) {\n        return true;\n    }\n    return Object.entries(obj).length === 0 && obj.constructor === Object;\n}\nexport default {\n    resetSubmitErrors: resetSubmitErrors,\n};\n"]},"metadata":{},"sourceType":"module"}