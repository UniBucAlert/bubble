{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nimport { useCallback, useEffect, useRef } from 'react';\nimport get from 'lodash/get';\nimport isEqual from 'lodash/isEqual';\nimport { useSafeSetState, removeEmpty } from '../../util';\nimport { useGetMany } from '../../dataProvider';\nimport { useNotify } from '../../sideEffect';\nimport usePaginationState from '../usePaginationState';\nimport useSelectionState from '../useSelectionState';\nimport useSortState from '../useSortState';\nimport { useResourceContext } from '../../core';\nimport { indexById } from '../../util/indexById';\nvar emptyArray = [];\nvar defaultFilter = {};\nvar defaultSort = {\n  field: null,\n  order: null\n};\n/**\n * Hook that fetches records from another resource specified\n * by an array of *ids* in current record.\n *\n * @example\n *\n * const { ids, data, error, loaded, loading, referenceBasePath } = useReferenceArrayFieldController({\n *      basePath: 'resource';\n *      record: { referenceIds: ['id1', 'id2']};\n *      reference: 'reference';\n *      resource: 'resource';\n *      source: 'referenceIds';\n * });\n *\n * @param {Object} props\n * @param {string} props.basePath basepath to current resource\n * @param {Object} props.record The current resource record\n * @param {string} props.reference The linked resource name\n * @param {string} props.resource The current resource name\n * @param {string} props.source The key of the linked resource identifier\n *\n * @param {Props} props\n *\n * @returns {ReferenceArrayProps} The reference props\n */\n\nvar useReferenceArrayFieldController = function (props) {\n  var basePath = props.basePath,\n      _a = props.filter,\n      filter = _a === void 0 ? defaultFilter : _a,\n      _b = props.page,\n      initialPage = _b === void 0 ? 1 : _b,\n      _c = props.perPage,\n      initialPerPage = _c === void 0 ? 1000 : _c,\n      record = props.record,\n      reference = props.reference,\n      _d = props.sort,\n      initialSort = _d === void 0 ? defaultSort : _d,\n      source = props.source;\n  var resource = useResourceContext(props);\n  var notify = useNotify();\n  var ids = get(record, source) || emptyArray;\n\n  var _e = useGetMany(reference, ids, {\n    onFailure: function (error) {\n      return notify(typeof error === 'string' ? error : error.message || 'ra.notification.http_error', 'warning', {\n        _: typeof error === 'string' ? error : error && error.message ? error.message : undefined\n      });\n    }\n  }),\n      data = _e.data,\n      error = _e.error,\n      loading = _e.loading,\n      loaded = _e.loaded;\n\n  var _f = useSafeSetState(loading),\n      loadingState = _f[0],\n      setLoadingState = _f[1];\n\n  var _g = useSafeSetState(loaded),\n      loadedState = _g[0],\n      setLoadedState = _g[1];\n\n  var _h = useSafeSetState(indexById(data)),\n      finalData = _h[0],\n      setFinalData = _h[1];\n\n  var _j = useSafeSetState(ids),\n      finalIds = _j[0],\n      setFinalIds = _j[1]; // pagination logic\n\n\n  var _k = usePaginationState({\n    page: initialPage,\n    perPage: initialPerPage\n  }),\n      page = _k.page,\n      setPage = _k.setPage,\n      perPage = _k.perPage,\n      setPerPage = _k.setPerPage; // sort logic\n\n\n  var _l = useSortState(initialSort),\n      sort = _l.sort,\n      setSortObject = _l.setSort;\n\n  var setSort = useCallback(function (field, order) {\n    if (order === void 0) {\n      order = 'ASC';\n    }\n\n    setSortObject({\n      field: field,\n      order: order\n    });\n    setPage(1);\n  }, [setPage, setSortObject]); // selection logic\n\n  var _m = useSelectionState(),\n      selectedIds = _m.selectedIds,\n      onSelect = _m.onSelect,\n      onToggleItem = _m.onToggleItem,\n      onUnselectItems = _m.onUnselectItems; // filter logic\n\n\n  var filterRef = useRef(filter);\n\n  var _o = useSafeSetState({}),\n      displayedFilters = _o[0],\n      setDisplayedFilters = _o[1];\n\n  var _p = useSafeSetState(filter),\n      filterValues = _p[0],\n      setFilterValues = _p[1];\n\n  var hideFilter = useCallback(function (filterName) {\n    setDisplayedFilters(function (previousState) {\n      var _a = previousState,\n          _b = filterName,\n          _ = _a[_b],\n          newState = __rest(_a, [typeof _b === \"symbol\" ? _b : _b + \"\"]);\n\n      return newState;\n    });\n    setFilterValues(function (previousState) {\n      var _a = previousState,\n          _b = filterName,\n          _ = _a[_b],\n          newState = __rest(_a, [typeof _b === \"symbol\" ? _b : _b + \"\"]);\n\n      return newState;\n    });\n  }, [setDisplayedFilters, setFilterValues]);\n  var showFilter = useCallback(function (filterName, defaultValue) {\n    setDisplayedFilters(function (previousState) {\n      var _a;\n\n      return __assign(__assign({}, previousState), (_a = {}, _a[filterName] = true, _a));\n    });\n    setFilterValues(function (previousState) {\n      var _a;\n\n      return __assign(__assign({}, previousState), (_a = {}, _a[filterName] = defaultValue, _a));\n    });\n  }, [setDisplayedFilters, setFilterValues]);\n  var setFilters = useCallback(function (filters, displayedFilters) {\n    setFilterValues(removeEmpty(filters));\n    setDisplayedFilters(displayedFilters);\n    setPage(1);\n  }, [setDisplayedFilters, setFilterValues, setPage]); // handle filter prop change\n\n  useEffect(function () {\n    if (!isEqual(filter, filterRef.current)) {\n      filterRef.current = filter;\n      setFilterValues(filter);\n    }\n  }); // We do all the data processing (filtering, sorting, paginating) client-side\n\n  useEffect(function () {\n    if (!loaded) return; // 1. filter\n\n    var tempData = data.filter(function (record) {\n      return Object.entries(filterValues).every(function (_a) {\n        var filterName = _a[0],\n            filterValue = _a[1];\n        return Array.isArray(get(record, filterName)) ? get(record, filterName).includes(filterValue) : // eslint-disable-next-line eqeqeq\n        filterValue == get(record, filterName);\n      });\n    }); // 2. sort\n\n    if (sort.field) {\n      tempData = tempData.sort(function (a, b) {\n        if (get(a, sort.field) > get(b, sort.field)) {\n          return sort.order === 'ASC' ? 1 : -1;\n        }\n\n        if (get(a, sort.field) < get(b, sort.field)) {\n          return sort.order === 'ASC' ? -1 : 1;\n        }\n\n        return 0;\n      });\n    } // 3. paginate\n\n\n    tempData = tempData.slice((page - 1) * perPage, page * perPage);\n    setFinalData(indexById(tempData));\n    setFinalIds(tempData.filter(function (data) {\n      return typeof data !== 'undefined';\n    }).map(function (data) {\n      return data.id;\n    }));\n  }, [data, filterValues, loaded, page, perPage, setFinalData, setFinalIds, sort.field, sort.order]);\n  useEffect(function () {\n    if (loaded !== loadedState) {\n      setLoadedState(loaded);\n    }\n  }, [loaded, loadedState, setLoadedState]);\n  useEffect(function () {\n    if (loading !== loadingState) {\n      setLoadingState(loading);\n    }\n  }, [loading, loadingState, setLoadingState]);\n  return {\n    basePath: basePath ? basePath.replace(resource, reference) : \"/\" + reference,\n    currentSort: sort,\n    data: finalData,\n    defaultTitle: null,\n    error: error,\n    displayedFilters: displayedFilters,\n    filterValues: filterValues,\n    hasCreate: false,\n    hideFilter: hideFilter,\n    ids: finalIds,\n    loaded: loadedState,\n    loading: loadingState,\n    onSelect: onSelect,\n    onToggleItem: onToggleItem,\n    onUnselectItems: onUnselectItems,\n    page: page,\n    perPage: perPage,\n    resource: reference,\n    selectedIds: selectedIds,\n    setFilters: setFilters,\n    setPage: setPage,\n    setPerPage: setPerPage,\n    setSort: setSort,\n    showFilter: showFilter,\n    total: finalIds.length\n  };\n};\n\nexport default useReferenceArrayFieldController;","map":{"version":3,"sources":["/node_modules/ra-core/esm/controller/field/useReferenceArrayFieldController.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__rest","e","indexOf","getOwnPropertySymbols","propertyIsEnumerable","useCallback","useEffect","useRef","get","isEqual","useSafeSetState","removeEmpty","useGetMany","useNotify","usePaginationState","useSelectionState","useSortState","useResourceContext","indexById","emptyArray","defaultFilter","defaultSort","field","order","useReferenceArrayFieldController","props","basePath","_a","filter","_b","page","initialPage","_c","perPage","initialPerPage","record","reference","_d","sort","initialSort","source","resource","notify","ids","_e","onFailure","error","message","_","undefined","data","loading","loaded","_f","loadingState","setLoadingState","_g","loadedState","setLoadedState","_h","finalData","setFinalData","_j","finalIds","setFinalIds","_k","setPage","setPerPage","_l","setSortObject","setSort","_m","selectedIds","onSelect","onToggleItem","onUnselectItems","filterRef","_o","displayedFilters","setDisplayedFilters","_p","filterValues","setFilterValues","hideFilter","filterName","previousState","newState","showFilter","defaultValue","setFilters","filters","current","tempData","entries","every","filterValue","Array","isArray","includes","a","b","slice","map","id","replace","currentSort","defaultTitle","hasCreate","total"],"mappings":"AAAA,IAAIA,QAAQ,GAAI,QAAQ,KAAKA,QAAd,IAA2B,YAAY;AAClDA,EAAAA,QAAQ,GAAGC,MAAM,CAACC,MAAP,IAAiB,UAASC,CAAT,EAAY;AACpC,SAAK,IAAIC,CAAJ,EAAOC,CAAC,GAAG,CAAX,EAAcC,CAAC,GAAGC,SAAS,CAACC,MAAjC,EAAyCH,CAAC,GAAGC,CAA7C,EAAgDD,CAAC,EAAjD,EAAqD;AACjDD,MAAAA,CAAC,GAAGG,SAAS,CAACF,CAAD,CAAb;;AACA,WAAK,IAAII,CAAT,IAAcL,CAAd,EAAiB,IAAIH,MAAM,CAACS,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCR,CAArC,EAAwCK,CAAxC,CAAJ,EACbN,CAAC,CAACM,CAAD,CAAD,GAAOL,CAAC,CAACK,CAAD,CAAR;AACP;;AACD,WAAON,CAAP;AACH,GAPD;;AAQA,SAAOH,QAAQ,CAACa,KAAT,CAAe,IAAf,EAAqBN,SAArB,CAAP;AACH,CAVD;;AAWA,IAAIO,MAAM,GAAI,QAAQ,KAAKA,MAAd,IAAyB,UAAUV,CAAV,EAAaW,CAAb,EAAgB;AAClD,MAAIZ,CAAC,GAAG,EAAR;;AACA,OAAK,IAAIM,CAAT,IAAcL,CAAd,EAAiB,IAAIH,MAAM,CAACS,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCR,CAArC,EAAwCK,CAAxC,KAA8CM,CAAC,CAACC,OAAF,CAAUP,CAAV,IAAe,CAAjE,EACbN,CAAC,CAACM,CAAD,CAAD,GAAOL,CAAC,CAACK,CAAD,CAAR;;AACJ,MAAIL,CAAC,IAAI,IAAL,IAAa,OAAOH,MAAM,CAACgB,qBAAd,KAAwC,UAAzD,EACI,KAAK,IAAIZ,CAAC,GAAG,CAAR,EAAWI,CAAC,GAAGR,MAAM,CAACgB,qBAAP,CAA6Bb,CAA7B,CAApB,EAAqDC,CAAC,GAAGI,CAAC,CAACD,MAA3D,EAAmEH,CAAC,EAApE,EAAwE;AACpE,QAAIU,CAAC,CAACC,OAAF,CAAUP,CAAC,CAACJ,CAAD,CAAX,IAAkB,CAAlB,IAAuBJ,MAAM,CAACS,SAAP,CAAiBQ,oBAAjB,CAAsCN,IAAtC,CAA2CR,CAA3C,EAA8CK,CAAC,CAACJ,CAAD,CAA/C,CAA3B,EACIF,CAAC,CAACM,CAAC,CAACJ,CAAD,CAAF,CAAD,GAAUD,CAAC,CAACK,CAAC,CAACJ,CAAD,CAAF,CAAX;AACP;AACL,SAAOF,CAAP;AACH,CAVD;;AAWA,SAASgB,WAAT,EAAsBC,SAAtB,EAAiCC,MAAjC,QAA+C,OAA/C;AACA,OAAOC,GAAP,MAAgB,YAAhB;AACA,OAAOC,OAAP,MAAoB,gBAApB;AACA,SAASC,eAAT,EAA0BC,WAA1B,QAA6C,YAA7C;AACA,SAASC,UAAT,QAA2B,oBAA3B;AACA,SAASC,SAAT,QAA0B,kBAA1B;AACA,OAAOC,kBAAP,MAA+B,uBAA/B;AACA,OAAOC,iBAAP,MAA8B,sBAA9B;AACA,OAAOC,YAAP,MAAyB,iBAAzB;AACA,SAASC,kBAAT,QAAmC,YAAnC;AACA,SAASC,SAAT,QAA0B,sBAA1B;AACA,IAAIC,UAAU,GAAG,EAAjB;AACA,IAAIC,aAAa,GAAG,EAApB;AACA,IAAIC,WAAW,GAAG;AAAEC,EAAAA,KAAK,EAAE,IAAT;AAAeC,EAAAA,KAAK,EAAE;AAAtB,CAAlB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,IAAIC,gCAAgC,GAAG,UAAUC,KAAV,EAAiB;AACpD,MAAIC,QAAQ,GAAGD,KAAK,CAACC,QAArB;AAAA,MAA+BC,EAAE,GAAGF,KAAK,CAACG,MAA1C;AAAA,MAAkDA,MAAM,GAAGD,EAAE,KAAK,KAAK,CAAZ,GAAgBP,aAAhB,GAAgCO,EAA3F;AAAA,MAA+FE,EAAE,GAAGJ,KAAK,CAACK,IAA1G;AAAA,MAAgHC,WAAW,GAAGF,EAAE,KAAK,KAAK,CAAZ,GAAgB,CAAhB,GAAoBA,EAAlJ;AAAA,MAAsJG,EAAE,GAAGP,KAAK,CAACQ,OAAjK;AAAA,MAA0KC,cAAc,GAAGF,EAAE,KAAK,KAAK,CAAZ,GAAgB,IAAhB,GAAuBA,EAAlN;AAAA,MAAsNG,MAAM,GAAGV,KAAK,CAACU,MAArO;AAAA,MAA6OC,SAAS,GAAGX,KAAK,CAACW,SAA/P;AAAA,MAA0QC,EAAE,GAAGZ,KAAK,CAACa,IAArR;AAAA,MAA2RC,WAAW,GAAGF,EAAE,KAAK,KAAK,CAAZ,GAAgBhB,WAAhB,GAA8BgB,EAAvU;AAAA,MAA2UG,MAAM,GAAGf,KAAK,CAACe,MAA1V;AACA,MAAIC,QAAQ,GAAGxB,kBAAkB,CAACQ,KAAD,CAAjC;AACA,MAAIiB,MAAM,GAAG7B,SAAS,EAAtB;AACA,MAAI8B,GAAG,GAAGnC,GAAG,CAAC2B,MAAD,EAASK,MAAT,CAAH,IAAuBrB,UAAjC;;AACA,MAAIyB,EAAE,GAAGhC,UAAU,CAACwB,SAAD,EAAYO,GAAZ,EAAiB;AAChCE,IAAAA,SAAS,EAAE,UAAUC,KAAV,EAAiB;AACxB,aAAOJ,MAAM,CAAC,OAAOI,KAAP,KAAiB,QAAjB,GACRA,KADQ,GAERA,KAAK,CAACC,OAAN,IAAiB,4BAFV,EAEwC,SAFxC,EAEmD;AAC5DC,QAAAA,CAAC,EAAE,OAAOF,KAAP,KAAiB,QAAjB,GACGA,KADH,GAEGA,KAAK,IAAIA,KAAK,CAACC,OAAf,GACID,KAAK,CAACC,OADV,GAEIE;AALkD,OAFnD,CAAb;AASH;AAX+B,GAAjB,CAAnB;AAAA,MAYIC,IAAI,GAAGN,EAAE,CAACM,IAZd;AAAA,MAYoBJ,KAAK,GAAGF,EAAE,CAACE,KAZ/B;AAAA,MAYsCK,OAAO,GAAGP,EAAE,CAACO,OAZnD;AAAA,MAY4DC,MAAM,GAAGR,EAAE,CAACQ,MAZxE;;AAaA,MAAIC,EAAE,GAAG3C,eAAe,CAACyC,OAAD,CAAxB;AAAA,MAAmCG,YAAY,GAAGD,EAAE,CAAC,CAAD,CAApD;AAAA,MAAyDE,eAAe,GAAGF,EAAE,CAAC,CAAD,CAA7E;;AACA,MAAIG,EAAE,GAAG9C,eAAe,CAAC0C,MAAD,CAAxB;AAAA,MAAkCK,WAAW,GAAGD,EAAE,CAAC,CAAD,CAAlD;AAAA,MAAuDE,cAAc,GAAGF,EAAE,CAAC,CAAD,CAA1E;;AACA,MAAIG,EAAE,GAAGjD,eAAe,CAACQ,SAAS,CAACgC,IAAD,CAAV,CAAxB;AAAA,MAA2CU,SAAS,GAAGD,EAAE,CAAC,CAAD,CAAzD;AAAA,MAA8DE,YAAY,GAAGF,EAAE,CAAC,CAAD,CAA/E;;AACA,MAAIG,EAAE,GAAGpD,eAAe,CAACiC,GAAD,CAAxB;AAAA,MAA+BoB,QAAQ,GAAGD,EAAE,CAAC,CAAD,CAA5C;AAAA,MAAiDE,WAAW,GAAGF,EAAE,CAAC,CAAD,CAAjE,CArBoD,CAsBpD;;;AACA,MAAIG,EAAE,GAAGnD,kBAAkB,CAAC;AACxBgB,IAAAA,IAAI,EAAEC,WADkB;AAExBE,IAAAA,OAAO,EAAEC;AAFe,GAAD,CAA3B;AAAA,MAGIJ,IAAI,GAAGmC,EAAE,CAACnC,IAHd;AAAA,MAGoBoC,OAAO,GAAGD,EAAE,CAACC,OAHjC;AAAA,MAG0CjC,OAAO,GAAGgC,EAAE,CAAChC,OAHvD;AAAA,MAGgEkC,UAAU,GAAGF,EAAE,CAACE,UAHhF,CAvBoD,CA2BpD;;;AACA,MAAIC,EAAE,GAAGpD,YAAY,CAACuB,WAAD,CAArB;AAAA,MAAoCD,IAAI,GAAG8B,EAAE,CAAC9B,IAA9C;AAAA,MAAoD+B,aAAa,GAAGD,EAAE,CAACE,OAAvE;;AACA,MAAIA,OAAO,GAAGjE,WAAW,CAAC,UAAUiB,KAAV,EAAiBC,KAAjB,EAAwB;AAC9C,QAAIA,KAAK,KAAK,KAAK,CAAnB,EAAsB;AAAEA,MAAAA,KAAK,GAAG,KAAR;AAAgB;;AACxC8C,IAAAA,aAAa,CAAC;AAAE/C,MAAAA,KAAK,EAAEA,KAAT;AAAgBC,MAAAA,KAAK,EAAEA;AAAvB,KAAD,CAAb;AACA2C,IAAAA,OAAO,CAAC,CAAD,CAAP;AACH,GAJwB,EAItB,CAACA,OAAD,EAAUG,aAAV,CAJsB,CAAzB,CA7BoD,CAkCpD;;AACA,MAAIE,EAAE,GAAGxD,iBAAiB,EAA1B;AAAA,MAA8ByD,WAAW,GAAGD,EAAE,CAACC,WAA/C;AAAA,MAA4DC,QAAQ,GAAGF,EAAE,CAACE,QAA1E;AAAA,MAAoFC,YAAY,GAAGH,EAAE,CAACG,YAAtG;AAAA,MAAoHC,eAAe,GAAGJ,EAAE,CAACI,eAAzI,CAnCoD,CAoCpD;;;AACA,MAAIC,SAAS,GAAGrE,MAAM,CAACqB,MAAD,CAAtB;;AACA,MAAIiD,EAAE,GAAGnE,eAAe,CAAC,EAAD,CAAxB;AAAA,MAA8BoE,gBAAgB,GAAGD,EAAE,CAAC,CAAD,CAAnD;AAAA,MAAwDE,mBAAmB,GAAGF,EAAE,CAAC,CAAD,CAAhF;;AACA,MAAIG,EAAE,GAAGtE,eAAe,CAACkB,MAAD,CAAxB;AAAA,MAAkCqD,YAAY,GAAGD,EAAE,CAAC,CAAD,CAAnD;AAAA,MAAwDE,eAAe,GAAGF,EAAE,CAAC,CAAD,CAA5E;;AACA,MAAIG,UAAU,GAAG9E,WAAW,CAAC,UAAU+E,UAAV,EAAsB;AAC/CL,IAAAA,mBAAmB,CAAC,UAAUM,aAAV,EAAyB;AACzC,UAAI1D,EAAE,GAAG0D,aAAT;AAAA,UAAwBxD,EAAE,GAAGuD,UAA7B;AAAA,UAAyCpC,CAAC,GAAGrB,EAAE,CAACE,EAAD,CAA/C;AAAA,UAAqDyD,QAAQ,GAAGtF,MAAM,CAAC2B,EAAD,EAAK,CAAC,OAAOE,EAAP,KAAc,QAAd,GAAyBA,EAAzB,GAA8BA,EAAE,GAAG,EAApC,CAAL,CAAtE;;AACA,aAAOyD,QAAP;AACH,KAHkB,CAAnB;AAIAJ,IAAAA,eAAe,CAAC,UAAUG,aAAV,EAAyB;AACrC,UAAI1D,EAAE,GAAG0D,aAAT;AAAA,UAAwBxD,EAAE,GAAGuD,UAA7B;AAAA,UAAyCpC,CAAC,GAAGrB,EAAE,CAACE,EAAD,CAA/C;AAAA,UAAqDyD,QAAQ,GAAGtF,MAAM,CAAC2B,EAAD,EAAK,CAAC,OAAOE,EAAP,KAAc,QAAd,GAAyBA,EAAzB,GAA8BA,EAAE,GAAG,EAApC,CAAL,CAAtE;;AACA,aAAOyD,QAAP;AACH,KAHc,CAAf;AAIH,GAT2B,EASzB,CAACP,mBAAD,EAAsBG,eAAtB,CATyB,CAA5B;AAUA,MAAIK,UAAU,GAAGlF,WAAW,CAAC,UAAU+E,UAAV,EAAsBI,YAAtB,EAAoC;AAC7DT,IAAAA,mBAAmB,CAAC,UAAUM,aAAV,EAAyB;AACzC,UAAI1D,EAAJ;;AACA,aAAQzC,QAAQ,CAACA,QAAQ,CAAC,EAAD,EAAKmG,aAAL,CAAT,GAA+B1D,EAAE,GAAG,EAAL,EAASA,EAAE,CAACyD,UAAD,CAAF,GAAiB,IAA1B,EAAgCzD,EAA/D,EAAhB;AACH,KAHkB,CAAnB;AAIAuD,IAAAA,eAAe,CAAC,UAAUG,aAAV,EAAyB;AACrC,UAAI1D,EAAJ;;AACA,aAAQzC,QAAQ,CAACA,QAAQ,CAAC,EAAD,EAAKmG,aAAL,CAAT,GAA+B1D,EAAE,GAAG,EAAL,EAASA,EAAE,CAACyD,UAAD,CAAF,GAAiBI,YAA1B,EAAwC7D,EAAvE,EAAhB;AACH,KAHc,CAAf;AAIH,GAT2B,EASzB,CAACoD,mBAAD,EAAsBG,eAAtB,CATyB,CAA5B;AAUA,MAAIO,UAAU,GAAGpF,WAAW,CAAC,UAAUqF,OAAV,EAAmBZ,gBAAnB,EAAqC;AAC9DI,IAAAA,eAAe,CAACvE,WAAW,CAAC+E,OAAD,CAAZ,CAAf;AACAX,IAAAA,mBAAmB,CAACD,gBAAD,CAAnB;AACAZ,IAAAA,OAAO,CAAC,CAAD,CAAP;AACH,GAJ2B,EAIzB,CAACa,mBAAD,EAAsBG,eAAtB,EAAuChB,OAAvC,CAJyB,CAA5B,CA5DoD,CAiEpD;;AACA5D,EAAAA,SAAS,CAAC,YAAY;AAClB,QAAI,CAACG,OAAO,CAACmB,MAAD,EAASgD,SAAS,CAACe,OAAnB,CAAZ,EAAyC;AACrCf,MAAAA,SAAS,CAACe,OAAV,GAAoB/D,MAApB;AACAsD,MAAAA,eAAe,CAACtD,MAAD,CAAf;AACH;AACJ,GALQ,CAAT,CAlEoD,CAwEpD;;AACAtB,EAAAA,SAAS,CAAC,YAAY;AAClB,QAAI,CAAC8C,MAAL,EACI,OAFc,CAGlB;;AACA,QAAIwC,QAAQ,GAAG1C,IAAI,CAACtB,MAAL,CAAY,UAAUO,MAAV,EAAkB;AACzC,aAAOhD,MAAM,CAAC0G,OAAP,CAAeZ,YAAf,EAA6Ba,KAA7B,CAAmC,UAAUnE,EAAV,EAAc;AACpD,YAAIyD,UAAU,GAAGzD,EAAE,CAAC,CAAD,CAAnB;AAAA,YAAwBoE,WAAW,GAAGpE,EAAE,CAAC,CAAD,CAAxC;AACA,eAAOqE,KAAK,CAACC,OAAN,CAAczF,GAAG,CAAC2B,MAAD,EAASiD,UAAT,CAAjB,IACD5E,GAAG,CAAC2B,MAAD,EAASiD,UAAT,CAAH,CAAwBc,QAAxB,CAAiCH,WAAjC,CADC,GAED;AACEA,QAAAA,WAAW,IAAIvF,GAAG,CAAC2B,MAAD,EAASiD,UAAT,CAH1B;AAIH,OANM,CAAP;AAOH,KARc,CAAf,CAJkB,CAalB;;AACA,QAAI9C,IAAI,CAAChB,KAAT,EAAgB;AACZsE,MAAAA,QAAQ,GAAGA,QAAQ,CAACtD,IAAT,CAAc,UAAU6D,CAAV,EAAaC,CAAb,EAAgB;AACrC,YAAI5F,GAAG,CAAC2F,CAAD,EAAI7D,IAAI,CAAChB,KAAT,CAAH,GAAqBd,GAAG,CAAC4F,CAAD,EAAI9D,IAAI,CAAChB,KAAT,CAA5B,EAA6C;AACzC,iBAAOgB,IAAI,CAACf,KAAL,KAAe,KAAf,GAAuB,CAAvB,GAA2B,CAAC,CAAnC;AACH;;AACD,YAAIf,GAAG,CAAC2F,CAAD,EAAI7D,IAAI,CAAChB,KAAT,CAAH,GAAqBd,GAAG,CAAC4F,CAAD,EAAI9D,IAAI,CAAChB,KAAT,CAA5B,EAA6C;AACzC,iBAAOgB,IAAI,CAACf,KAAL,KAAe,KAAf,GAAuB,CAAC,CAAxB,GAA4B,CAAnC;AACH;;AACD,eAAO,CAAP;AACH,OARU,CAAX;AASH,KAxBiB,CAyBlB;;;AACAqE,IAAAA,QAAQ,GAAGA,QAAQ,CAACS,KAAT,CAAe,CAACvE,IAAI,GAAG,CAAR,IAAaG,OAA5B,EAAqCH,IAAI,GAAGG,OAA5C,CAAX;AACA4B,IAAAA,YAAY,CAAC3C,SAAS,CAAC0E,QAAD,CAAV,CAAZ;AACA5B,IAAAA,WAAW,CAAC4B,QAAQ,CACfhE,MADO,CACA,UAAUsB,IAAV,EAAgB;AAAE,aAAO,OAAOA,IAAP,KAAgB,WAAvB;AAAqC,KADvD,EAEPoD,GAFO,CAEH,UAAUpD,IAAV,EAAgB;AAAE,aAAOA,IAAI,CAACqD,EAAZ;AAAiB,KAFhC,CAAD,CAAX;AAGH,GA/BQ,EA+BN,CACCrD,IADD,EAEC+B,YAFD,EAGC7B,MAHD,EAICtB,IAJD,EAKCG,OALD,EAMC4B,YAND,EAOCG,WAPD,EAQC1B,IAAI,CAAChB,KARN,EASCgB,IAAI,CAACf,KATN,CA/BM,CAAT;AA0CAjB,EAAAA,SAAS,CAAC,YAAY;AAClB,QAAI8C,MAAM,KAAKK,WAAf,EAA4B;AACxBC,MAAAA,cAAc,CAACN,MAAD,CAAd;AACH;AACJ,GAJQ,EAIN,CAACA,MAAD,EAASK,WAAT,EAAsBC,cAAtB,CAJM,CAAT;AAKApD,EAAAA,SAAS,CAAC,YAAY;AAClB,QAAI6C,OAAO,KAAKG,YAAhB,EAA8B;AAC1BC,MAAAA,eAAe,CAACJ,OAAD,CAAf;AACH;AACJ,GAJQ,EAIN,CAACA,OAAD,EAAUG,YAAV,EAAwBC,eAAxB,CAJM,CAAT;AAKA,SAAO;AACH7B,IAAAA,QAAQ,EAAEA,QAAQ,GACZA,QAAQ,CAAC8E,OAAT,CAAiB/D,QAAjB,EAA2BL,SAA3B,CADY,GAEZ,MAAMA,SAHT;AAIHqE,IAAAA,WAAW,EAAEnE,IAJV;AAKHY,IAAAA,IAAI,EAAEU,SALH;AAMH8C,IAAAA,YAAY,EAAE,IANX;AAOH5D,IAAAA,KAAK,EAAEA,KAPJ;AAQHgC,IAAAA,gBAAgB,EAAEA,gBARf;AASHG,IAAAA,YAAY,EAAEA,YATX;AAUH0B,IAAAA,SAAS,EAAE,KAVR;AAWHxB,IAAAA,UAAU,EAAEA,UAXT;AAYHxC,IAAAA,GAAG,EAAEoB,QAZF;AAaHX,IAAAA,MAAM,EAAEK,WAbL;AAcHN,IAAAA,OAAO,EAAEG,YAdN;AAeHmB,IAAAA,QAAQ,EAAEA,QAfP;AAgBHC,IAAAA,YAAY,EAAEA,YAhBX;AAiBHC,IAAAA,eAAe,EAAEA,eAjBd;AAkBH7C,IAAAA,IAAI,EAAEA,IAlBH;AAmBHG,IAAAA,OAAO,EAAEA,OAnBN;AAoBHQ,IAAAA,QAAQ,EAAEL,SApBP;AAqBHoC,IAAAA,WAAW,EAAEA,WArBV;AAsBHiB,IAAAA,UAAU,EAAEA,UAtBT;AAuBHvB,IAAAA,OAAO,EAAEA,OAvBN;AAwBHC,IAAAA,UAAU,EAAEA,UAxBT;AAyBHG,IAAAA,OAAO,EAAEA,OAzBN;AA0BHiB,IAAAA,UAAU,EAAEA,UA1BT;AA2BHqB,IAAAA,KAAK,EAAE7C,QAAQ,CAACrE;AA3Bb,GAAP;AA6BH,CA1JD;;AA2JA,eAAe8B,gCAAf","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nimport { useCallback, useEffect, useRef } from 'react';\nimport get from 'lodash/get';\nimport isEqual from 'lodash/isEqual';\nimport { useSafeSetState, removeEmpty } from '../../util';\nimport { useGetMany } from '../../dataProvider';\nimport { useNotify } from '../../sideEffect';\nimport usePaginationState from '../usePaginationState';\nimport useSelectionState from '../useSelectionState';\nimport useSortState from '../useSortState';\nimport { useResourceContext } from '../../core';\nimport { indexById } from '../../util/indexById';\nvar emptyArray = [];\nvar defaultFilter = {};\nvar defaultSort = { field: null, order: null };\n/**\n * Hook that fetches records from another resource specified\n * by an array of *ids* in current record.\n *\n * @example\n *\n * const { ids, data, error, loaded, loading, referenceBasePath } = useReferenceArrayFieldController({\n *      basePath: 'resource';\n *      record: { referenceIds: ['id1', 'id2']};\n *      reference: 'reference';\n *      resource: 'resource';\n *      source: 'referenceIds';\n * });\n *\n * @param {Object} props\n * @param {string} props.basePath basepath to current resource\n * @param {Object} props.record The current resource record\n * @param {string} props.reference The linked resource name\n * @param {string} props.resource The current resource name\n * @param {string} props.source The key of the linked resource identifier\n *\n * @param {Props} props\n *\n * @returns {ReferenceArrayProps} The reference props\n */\nvar useReferenceArrayFieldController = function (props) {\n    var basePath = props.basePath, _a = props.filter, filter = _a === void 0 ? defaultFilter : _a, _b = props.page, initialPage = _b === void 0 ? 1 : _b, _c = props.perPage, initialPerPage = _c === void 0 ? 1000 : _c, record = props.record, reference = props.reference, _d = props.sort, initialSort = _d === void 0 ? defaultSort : _d, source = props.source;\n    var resource = useResourceContext(props);\n    var notify = useNotify();\n    var ids = get(record, source) || emptyArray;\n    var _e = useGetMany(reference, ids, {\n        onFailure: function (error) {\n            return notify(typeof error === 'string'\n                ? error\n                : error.message || 'ra.notification.http_error', 'warning', {\n                _: typeof error === 'string'\n                    ? error\n                    : error && error.message\n                        ? error.message\n                        : undefined,\n            });\n        },\n    }), data = _e.data, error = _e.error, loading = _e.loading, loaded = _e.loaded;\n    var _f = useSafeSetState(loading), loadingState = _f[0], setLoadingState = _f[1];\n    var _g = useSafeSetState(loaded), loadedState = _g[0], setLoadedState = _g[1];\n    var _h = useSafeSetState(indexById(data)), finalData = _h[0], setFinalData = _h[1];\n    var _j = useSafeSetState(ids), finalIds = _j[0], setFinalIds = _j[1];\n    // pagination logic\n    var _k = usePaginationState({\n        page: initialPage,\n        perPage: initialPerPage,\n    }), page = _k.page, setPage = _k.setPage, perPage = _k.perPage, setPerPage = _k.setPerPage;\n    // sort logic\n    var _l = useSortState(initialSort), sort = _l.sort, setSortObject = _l.setSort;\n    var setSort = useCallback(function (field, order) {\n        if (order === void 0) { order = 'ASC'; }\n        setSortObject({ field: field, order: order });\n        setPage(1);\n    }, [setPage, setSortObject]);\n    // selection logic\n    var _m = useSelectionState(), selectedIds = _m.selectedIds, onSelect = _m.onSelect, onToggleItem = _m.onToggleItem, onUnselectItems = _m.onUnselectItems;\n    // filter logic\n    var filterRef = useRef(filter);\n    var _o = useSafeSetState({}), displayedFilters = _o[0], setDisplayedFilters = _o[1];\n    var _p = useSafeSetState(filter), filterValues = _p[0], setFilterValues = _p[1];\n    var hideFilter = useCallback(function (filterName) {\n        setDisplayedFilters(function (previousState) {\n            var _a = previousState, _b = filterName, _ = _a[_b], newState = __rest(_a, [typeof _b === \"symbol\" ? _b : _b + \"\"]);\n            return newState;\n        });\n        setFilterValues(function (previousState) {\n            var _a = previousState, _b = filterName, _ = _a[_b], newState = __rest(_a, [typeof _b === \"symbol\" ? _b : _b + \"\"]);\n            return newState;\n        });\n    }, [setDisplayedFilters, setFilterValues]);\n    var showFilter = useCallback(function (filterName, defaultValue) {\n        setDisplayedFilters(function (previousState) {\n            var _a;\n            return (__assign(__assign({}, previousState), (_a = {}, _a[filterName] = true, _a)));\n        });\n        setFilterValues(function (previousState) {\n            var _a;\n            return (__assign(__assign({}, previousState), (_a = {}, _a[filterName] = defaultValue, _a)));\n        });\n    }, [setDisplayedFilters, setFilterValues]);\n    var setFilters = useCallback(function (filters, displayedFilters) {\n        setFilterValues(removeEmpty(filters));\n        setDisplayedFilters(displayedFilters);\n        setPage(1);\n    }, [setDisplayedFilters, setFilterValues, setPage]);\n    // handle filter prop change\n    useEffect(function () {\n        if (!isEqual(filter, filterRef.current)) {\n            filterRef.current = filter;\n            setFilterValues(filter);\n        }\n    });\n    // We do all the data processing (filtering, sorting, paginating) client-side\n    useEffect(function () {\n        if (!loaded)\n            return;\n        // 1. filter\n        var tempData = data.filter(function (record) {\n            return Object.entries(filterValues).every(function (_a) {\n                var filterName = _a[0], filterValue = _a[1];\n                return Array.isArray(get(record, filterName))\n                    ? get(record, filterName).includes(filterValue)\n                    : // eslint-disable-next-line eqeqeq\n                        filterValue == get(record, filterName);\n            });\n        });\n        // 2. sort\n        if (sort.field) {\n            tempData = tempData.sort(function (a, b) {\n                if (get(a, sort.field) > get(b, sort.field)) {\n                    return sort.order === 'ASC' ? 1 : -1;\n                }\n                if (get(a, sort.field) < get(b, sort.field)) {\n                    return sort.order === 'ASC' ? -1 : 1;\n                }\n                return 0;\n            });\n        }\n        // 3. paginate\n        tempData = tempData.slice((page - 1) * perPage, page * perPage);\n        setFinalData(indexById(tempData));\n        setFinalIds(tempData\n            .filter(function (data) { return typeof data !== 'undefined'; })\n            .map(function (data) { return data.id; }));\n    }, [\n        data,\n        filterValues,\n        loaded,\n        page,\n        perPage,\n        setFinalData,\n        setFinalIds,\n        sort.field,\n        sort.order,\n    ]);\n    useEffect(function () {\n        if (loaded !== loadedState) {\n            setLoadedState(loaded);\n        }\n    }, [loaded, loadedState, setLoadedState]);\n    useEffect(function () {\n        if (loading !== loadingState) {\n            setLoadingState(loading);\n        }\n    }, [loading, loadingState, setLoadingState]);\n    return {\n        basePath: basePath\n            ? basePath.replace(resource, reference)\n            : \"/\" + reference,\n        currentSort: sort,\n        data: finalData,\n        defaultTitle: null,\n        error: error,\n        displayedFilters: displayedFilters,\n        filterValues: filterValues,\n        hasCreate: false,\n        hideFilter: hideFilter,\n        ids: finalIds,\n        loaded: loadedState,\n        loading: loadingState,\n        onSelect: onSelect,\n        onToggleItem: onToggleItem,\n        onUnselectItems: onUnselectItems,\n        page: page,\n        perPage: perPage,\n        resource: reference,\n        selectedIds: selectedIds,\n        setFilters: setFilters,\n        setPage: setPage,\n        setPerPage: setPerPage,\n        setSort: setSort,\n        showFilter: showFilter,\n        total: finalIds.length,\n    };\n};\nexport default useReferenceArrayFieldController;\n"]},"metadata":{},"sourceType":"module"}