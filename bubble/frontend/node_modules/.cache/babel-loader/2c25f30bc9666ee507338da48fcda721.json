{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nimport { useCallback, useMemo, useEffect, useState } from 'react';\nimport { useSelector, useDispatch, shallowEqual } from 'react-redux';\nimport { parse, stringify } from 'query-string';\nimport lodashDebounce from 'lodash/debounce';\nimport set from 'lodash/set';\nimport pickBy from 'lodash/pickBy';\nimport { useHistory, useLocation } from 'react-router-dom';\nimport queryReducer, { SET_FILTER, SET_PAGE, SET_PER_PAGE, SET_SORT, SORT_ASC } from '../reducer/admin/resource/list/queryReducer';\nimport { changeListParams } from '../actions/listActions';\nimport removeEmpty from '../util/removeEmpty';\nimport removeKey from '../util/removeKey';\nvar emptyObject = {};\nvar defaultSort = {\n  field: 'id',\n  order: SORT_ASC\n};\nvar defaultParams = {};\n/**\n * Get the list parameters (page, sort, filters) and modifiers.\n *\n * These parameters are merged from 3 sources:\n *   - the query string from the URL\n *   - the params stored in the state (from previous navigation)\n *   - the options passed to the hook (including the filter defaultValues)\n *\n * @returns {Array} A tuple [parameters, modifiers].\n * Destructure as [\n *    { page, perPage, sort, order, filter, filterValues, displayedFilters, requestSignature },\n *    { setFilters, hideFilter, showFilter, setPage, setPerPage, setSort }\n * ]\n *\n * @example\n *\n * const [listParams, listParamsActions] = useListParams({\n *      resource: 'posts',\n *      location: location // From react-router. Injected to your component by react-admin inside a List\n *      filterDefaultValues: {\n *          published: true\n *      },\n *      sort: {\n *          field: 'published_at',\n *          order: 'DESC'\n *      },\n *      perPage: 25\n * });\n *\n * const {\n *      page,\n *      perPage,\n *      sort,\n *      order,\n *      filter,\n *      filterValues,\n *      displayedFilters,\n *      requestSignature\n * } = listParams;\n *\n * const {\n *      setFilters,\n *      hideFilter,\n *      showFilter,\n *      setPage,\n *      setPerPage,\n *      setSort,\n * } = listParamsActions;\n */\n\nvar useListParams = function (_a) {\n  var resource = _a.resource,\n      filterDefaultValues = _a.filterDefaultValues,\n      _b = _a.sort,\n      sort = _b === void 0 ? defaultSort : _b,\n      _c = _a.perPage,\n      perPage = _c === void 0 ? 10 : _c,\n      _d = _a.debounce,\n      debounce = _d === void 0 ? 500 : _d,\n      _e = _a.syncWithLocation,\n      syncWithLocation = _e === void 0 ? false : _e;\n  var dispatch = useDispatch();\n  var location = useLocation();\n  var history = useHistory();\n\n  var _f = useState(defaultParams),\n      localParams = _f[0],\n      setLocalParams = _f[1];\n\n  var params = useSelector(function (reduxState) {\n    return reduxState.admin.resources[resource] ? reduxState.admin.resources[resource].list.params : defaultParams;\n  }, shallowEqual);\n  var requestSignature = [location.search, resource, syncWithLocation ? params : localParams, filterDefaultValues, JSON.stringify(sort), perPage, syncWithLocation];\n  var queryFromLocation = syncWithLocation ? parseQueryFromLocation(location) : {};\n  var query = useMemo(function () {\n    return getQuery({\n      queryFromLocation: queryFromLocation,\n      params: syncWithLocation ? params : localParams,\n      filterDefaultValues: filterDefaultValues,\n      sort: sort,\n      perPage: perPage\n    });\n  }, requestSignature // eslint-disable-line react-hooks/exhaustive-deps\n  ); // On mount, if the location includes params (for example from a link like\n  // the categories products on the demo), we need to persist them in the\n  // redux state as well so that we don't lose them after a redirection back\n  // to the list\n\n  useEffect(function () {\n    if (Object.keys(queryFromLocation).length > 0) {\n      dispatch(changeListParams(resource, query));\n    }\n  }, []); // eslint-disable-line\n\n  var changeParams = useCallback(function (action) {\n    var newParams = queryReducer(query, action);\n\n    if (syncWithLocation) {\n      history.push({\n        search: \"?\" + stringify(__assign(__assign({}, newParams), {\n          filter: JSON.stringify(newParams.filter),\n          displayedFilters: JSON.stringify(newParams.displayedFilters)\n        })),\n        state: {\n          _scrollToTop: action.type === SET_PAGE\n        }\n      });\n      dispatch(changeListParams(resource, newParams));\n    } else {\n      setLocalParams(newParams);\n    }\n  }, requestSignature); // eslint-disable-line react-hooks/exhaustive-deps\n\n  var setSort = useCallback(function (sort, order) {\n    return changeParams({\n      type: SET_SORT,\n      payload: {\n        sort: sort,\n        order: order\n      }\n    });\n  }, requestSignature // eslint-disable-line react-hooks/exhaustive-deps\n  );\n  var setPage = useCallback(function (newPage) {\n    return changeParams({\n      type: SET_PAGE,\n      payload: newPage\n    });\n  }, requestSignature // eslint-disable-line react-hooks/exhaustive-deps\n  );\n  var setPerPage = useCallback(function (newPerPage) {\n    return changeParams({\n      type: SET_PER_PAGE,\n      payload: newPerPage\n    });\n  }, requestSignature // eslint-disable-line react-hooks/exhaustive-deps\n  );\n  var filterValues = query.filter || emptyObject;\n  var displayedFilterValues = query.displayedFilters || emptyObject;\n  var debouncedSetFilters = lodashDebounce(function (filter, displayedFilters) {\n    changeParams({\n      type: SET_FILTER,\n      payload: {\n        filter: removeEmpty(filter),\n        displayedFilters: displayedFilters\n      }\n    });\n  }, debounce);\n  var setFilters = useCallback(function (filter, displayedFilters, debounce) {\n    if (debounce === void 0) {\n      debounce = true;\n    }\n\n    return debounce ? debouncedSetFilters(filter, displayedFilters) : changeParams({\n      type: SET_FILTER,\n      payload: {\n        filter: removeEmpty(filter),\n        displayedFilters: displayedFilters\n      }\n    });\n  }, requestSignature // eslint-disable-line react-hooks/exhaustive-deps\n  );\n  var hideFilter = useCallback(function (filterName) {\n    // we don't use lodash.set() for displayed filters\n    // to avoid problems with compound filter names (e.g. 'author.name')\n    var displayedFilters = Object.keys(displayedFilterValues).reduce(function (filters, filter) {\n      var _a;\n\n      return filter !== filterName ? __assign(__assign({}, filters), (_a = {}, _a[filter] = true, _a)) : filters;\n    }, {});\n    var filter = removeEmpty(removeKey(filterValues, filterName));\n    changeParams({\n      type: SET_FILTER,\n      payload: {\n        filter: filter,\n        displayedFilters: displayedFilters\n      }\n    });\n  }, requestSignature); // eslint-disable-line react-hooks/exhaustive-deps\n\n  var showFilter = useCallback(function (filterName, defaultValue) {\n    var _a; // we don't use lodash.set() for displayed filters\n    // to avoid problems with compound filter names (e.g. 'author.name')\n\n\n    var displayedFilters = __assign(__assign({}, displayedFilterValues), (_a = {}, _a[filterName] = true, _a));\n\n    var filter = defaultValue ? set(filterValues, filterName, defaultValue) : filterValues;\n    changeParams({\n      type: SET_FILTER,\n      payload: {\n        filter: filter,\n        displayedFilters: displayedFilters\n      }\n    });\n  }, requestSignature); // eslint-disable-line react-hooks/exhaustive-deps\n\n  return [__assign({\n    displayedFilters: displayedFilterValues,\n    filterValues: filterValues,\n    requestSignature: requestSignature\n  }, query), {\n    changeParams: changeParams,\n    setPage: setPage,\n    setPerPage: setPerPage,\n    setSort: setSort,\n    setFilters: setFilters,\n    hideFilter: hideFilter,\n    showFilter: showFilter\n  }];\n};\n\nexport var validQueryParams = ['page', 'perPage', 'sort', 'order', 'filter', 'displayedFilters'];\n\nvar parseObject = function (query, field) {\n  if (query[field] && typeof query[field] === 'string') {\n    try {\n      query[field] = JSON.parse(query[field]);\n    } catch (err) {\n      delete query[field];\n    }\n  }\n};\n\nexport var parseQueryFromLocation = function (_a) {\n  var search = _a.search;\n  var query = pickBy(parse(search), function (v, k) {\n    return validQueryParams.indexOf(k) !== -1;\n  });\n  parseObject(query, 'filter');\n  parseObject(query, 'displayedFilters');\n  return query;\n};\n/**\n * Check if user has already set custom sort, page, or filters for this list\n *\n * User params come from the Redux store as the params props. By default,\n * this object is:\n *\n * { filter: {}, order: null, page: 1, perPage: null, sort: null }\n *\n * To check if the user has custom params, we must compare the params\n * to these initial values.\n *\n * @param {Object} params\n */\n\nexport var hasCustomParams = function (params) {\n  return params && params.filter && (Object.keys(params.filter).length > 0 || params.order != null || params.page !== 1 || params.perPage != null || params.sort != null);\n};\n/**\n * Merge list params from 3 different sources:\n *   - the query string\n *   - the params stored in the state (from previous navigation)\n *   - the props passed to the List component (including the filter defaultValues)\n */\n\nexport var getQuery = function (_a) {\n  var queryFromLocation = _a.queryFromLocation,\n      params = _a.params,\n      filterDefaultValues = _a.filterDefaultValues,\n      sort = _a.sort,\n      perPage = _a.perPage;\n  var query = Object.keys(queryFromLocation).length > 0 ? queryFromLocation : hasCustomParams(params) ? __assign({}, params) : {\n    filter: filterDefaultValues || {}\n  };\n\n  if (!query.sort) {\n    query.sort = sort.field;\n    query.order = sort.order;\n  }\n\n  if (query.perPage == null) {\n    query.perPage = perPage;\n  }\n\n  if (query.page == null) {\n    query.page = 1;\n  }\n\n  return __assign(__assign({}, query), {\n    page: getNumberOrDefault(query.page, 1),\n    perPage: getNumberOrDefault(query.perPage, 10)\n  });\n};\nexport var getNumberOrDefault = function (possibleNumber, defaultValue) {\n  var parsedNumber = typeof possibleNumber === 'string' ? parseInt(possibleNumber, 10) : possibleNumber;\n  return isNaN(parsedNumber) ? defaultValue : parsedNumber;\n};\nexport default useListParams;","map":{"version":3,"sources":["/node_modules/ra-core/esm/controller/useListParams.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","useCallback","useMemo","useEffect","useState","useSelector","useDispatch","shallowEqual","parse","stringify","lodashDebounce","set","pickBy","useHistory","useLocation","queryReducer","SET_FILTER","SET_PAGE","SET_PER_PAGE","SET_SORT","SORT_ASC","changeListParams","removeEmpty","removeKey","emptyObject","defaultSort","field","order","defaultParams","useListParams","_a","resource","filterDefaultValues","_b","sort","_c","perPage","_d","debounce","_e","syncWithLocation","dispatch","location","history","_f","localParams","setLocalParams","params","reduxState","admin","resources","list","requestSignature","search","JSON","queryFromLocation","parseQueryFromLocation","query","getQuery","keys","changeParams","action","newParams","push","filter","displayedFilters","state","_scrollToTop","type","setSort","payload","setPage","newPage","setPerPage","newPerPage","filterValues","displayedFilterValues","debouncedSetFilters","setFilters","hideFilter","filterName","reduce","filters","showFilter","defaultValue","validQueryParams","parseObject","err","v","k","indexOf","hasCustomParams","page","getNumberOrDefault","possibleNumber","parsedNumber","parseInt","isNaN"],"mappings":"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","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport { useCallback, useMemo, useEffect, useState } from 'react';\nimport { useSelector, useDispatch, shallowEqual } from 'react-redux';\nimport { parse, stringify } from 'query-string';\nimport lodashDebounce from 'lodash/debounce';\nimport set from 'lodash/set';\nimport pickBy from 'lodash/pickBy';\nimport { useHistory, useLocation } from 'react-router-dom';\nimport queryReducer, { SET_FILTER, SET_PAGE, SET_PER_PAGE, SET_SORT, SORT_ASC, } from '../reducer/admin/resource/list/queryReducer';\nimport { changeListParams } from '../actions/listActions';\nimport removeEmpty from '../util/removeEmpty';\nimport removeKey from '../util/removeKey';\nvar emptyObject = {};\nvar defaultSort = {\n    field: 'id',\n    order: SORT_ASC,\n};\nvar defaultParams = {};\n/**\n * Get the list parameters (page, sort, filters) and modifiers.\n *\n * These parameters are merged from 3 sources:\n *   - the query string from the URL\n *   - the params stored in the state (from previous navigation)\n *   - the options passed to the hook (including the filter defaultValues)\n *\n * @returns {Array} A tuple [parameters, modifiers].\n * Destructure as [\n *    { page, perPage, sort, order, filter, filterValues, displayedFilters, requestSignature },\n *    { setFilters, hideFilter, showFilter, setPage, setPerPage, setSort }\n * ]\n *\n * @example\n *\n * const [listParams, listParamsActions] = useListParams({\n *      resource: 'posts',\n *      location: location // From react-router. Injected to your component by react-admin inside a List\n *      filterDefaultValues: {\n *          published: true\n *      },\n *      sort: {\n *          field: 'published_at',\n *          order: 'DESC'\n *      },\n *      perPage: 25\n * });\n *\n * const {\n *      page,\n *      perPage,\n *      sort,\n *      order,\n *      filter,\n *      filterValues,\n *      displayedFilters,\n *      requestSignature\n * } = listParams;\n *\n * const {\n *      setFilters,\n *      hideFilter,\n *      showFilter,\n *      setPage,\n *      setPerPage,\n *      setSort,\n * } = listParamsActions;\n */\nvar useListParams = function (_a) {\n    var resource = _a.resource, filterDefaultValues = _a.filterDefaultValues, _b = _a.sort, sort = _b === void 0 ? defaultSort : _b, _c = _a.perPage, perPage = _c === void 0 ? 10 : _c, _d = _a.debounce, debounce = _d === void 0 ? 500 : _d, _e = _a.syncWithLocation, syncWithLocation = _e === void 0 ? false : _e;\n    var dispatch = useDispatch();\n    var location = useLocation();\n    var history = useHistory();\n    var _f = useState(defaultParams), localParams = _f[0], setLocalParams = _f[1];\n    var params = useSelector(function (reduxState) {\n        return reduxState.admin.resources[resource]\n            ? reduxState.admin.resources[resource].list.params\n            : defaultParams;\n    }, shallowEqual);\n    var requestSignature = [\n        location.search,\n        resource,\n        syncWithLocation ? params : localParams,\n        filterDefaultValues,\n        JSON.stringify(sort),\n        perPage,\n        syncWithLocation,\n    ];\n    var queryFromLocation = syncWithLocation\n        ? parseQueryFromLocation(location)\n        : {};\n    var query = useMemo(function () {\n        return getQuery({\n            queryFromLocation: queryFromLocation,\n            params: syncWithLocation ? params : localParams,\n            filterDefaultValues: filterDefaultValues,\n            sort: sort,\n            perPage: perPage,\n        });\n    }, requestSignature // eslint-disable-line react-hooks/exhaustive-deps\n    );\n    // On mount, if the location includes params (for example from a link like\n    // the categories products on the demo), we need to persist them in the\n    // redux state as well so that we don't lose them after a redirection back\n    // to the list\n    useEffect(function () {\n        if (Object.keys(queryFromLocation).length > 0) {\n            dispatch(changeListParams(resource, query));\n        }\n    }, []); // eslint-disable-line\n    var changeParams = useCallback(function (action) {\n        var newParams = queryReducer(query, action);\n        if (syncWithLocation) {\n            history.push({\n                search: \"?\" + stringify(__assign(__assign({}, newParams), { filter: JSON.stringify(newParams.filter), displayedFilters: JSON.stringify(newParams.displayedFilters) })),\n                state: { _scrollToTop: action.type === SET_PAGE },\n            });\n            dispatch(changeListParams(resource, newParams));\n        }\n        else {\n            setLocalParams(newParams);\n        }\n    }, requestSignature); // eslint-disable-line react-hooks/exhaustive-deps\n    var setSort = useCallback(function (sort, order) {\n        return changeParams({\n            type: SET_SORT,\n            payload: { sort: sort, order: order },\n        });\n    }, requestSignature // eslint-disable-line react-hooks/exhaustive-deps\n    );\n    var setPage = useCallback(function (newPage) { return changeParams({ type: SET_PAGE, payload: newPage }); }, requestSignature // eslint-disable-line react-hooks/exhaustive-deps\n    );\n    var setPerPage = useCallback(function (newPerPage) {\n        return changeParams({ type: SET_PER_PAGE, payload: newPerPage });\n    }, requestSignature // eslint-disable-line react-hooks/exhaustive-deps\n    );\n    var filterValues = query.filter || emptyObject;\n    var displayedFilterValues = query.displayedFilters || emptyObject;\n    var debouncedSetFilters = lodashDebounce(function (filter, displayedFilters) {\n        changeParams({\n            type: SET_FILTER,\n            payload: {\n                filter: removeEmpty(filter),\n                displayedFilters: displayedFilters,\n            },\n        });\n    }, debounce);\n    var setFilters = useCallback(function (filter, displayedFilters, debounce) {\n        if (debounce === void 0) { debounce = true; }\n        return debounce\n            ? debouncedSetFilters(filter, displayedFilters)\n            : changeParams({\n                type: SET_FILTER,\n                payload: {\n                    filter: removeEmpty(filter),\n                    displayedFilters: displayedFilters,\n                },\n            });\n    }, requestSignature // eslint-disable-line react-hooks/exhaustive-deps\n    );\n    var hideFilter = useCallback(function (filterName) {\n        // we don't use lodash.set() for displayed filters\n        // to avoid problems with compound filter names (e.g. 'author.name')\n        var displayedFilters = Object.keys(displayedFilterValues).reduce(function (filters, filter) {\n            var _a;\n            return filter !== filterName\n                ? __assign(__assign({}, filters), (_a = {}, _a[filter] = true, _a)) : filters;\n        }, {});\n        var filter = removeEmpty(removeKey(filterValues, filterName));\n        changeParams({\n            type: SET_FILTER,\n            payload: { filter: filter, displayedFilters: displayedFilters },\n        });\n    }, requestSignature); // eslint-disable-line react-hooks/exhaustive-deps\n    var showFilter = useCallback(function (filterName, defaultValue) {\n        var _a;\n        // we don't use lodash.set() for displayed filters\n        // to avoid problems with compound filter names (e.g. 'author.name')\n        var displayedFilters = __assign(__assign({}, displayedFilterValues), (_a = {}, _a[filterName] = true, _a));\n        var filter = defaultValue\n            ? set(filterValues, filterName, defaultValue)\n            : filterValues;\n        changeParams({\n            type: SET_FILTER,\n            payload: {\n                filter: filter,\n                displayedFilters: displayedFilters,\n            },\n        });\n    }, requestSignature); // eslint-disable-line react-hooks/exhaustive-deps\n    return [\n        __assign({ displayedFilters: displayedFilterValues, filterValues: filterValues,\n            requestSignature: requestSignature }, query),\n        {\n            changeParams: changeParams,\n            setPage: setPage,\n            setPerPage: setPerPage,\n            setSort: setSort,\n            setFilters: setFilters,\n            hideFilter: hideFilter,\n            showFilter: showFilter,\n        },\n    ];\n};\nexport var validQueryParams = [\n    'page',\n    'perPage',\n    'sort',\n    'order',\n    'filter',\n    'displayedFilters',\n];\nvar parseObject = function (query, field) {\n    if (query[field] && typeof query[field] === 'string') {\n        try {\n            query[field] = JSON.parse(query[field]);\n        }\n        catch (err) {\n            delete query[field];\n        }\n    }\n};\nexport var parseQueryFromLocation = function (_a) {\n    var search = _a.search;\n    var query = pickBy(parse(search), function (v, k) { return validQueryParams.indexOf(k) !== -1; });\n    parseObject(query, 'filter');\n    parseObject(query, 'displayedFilters');\n    return query;\n};\n/**\n * Check if user has already set custom sort, page, or filters for this list\n *\n * User params come from the Redux store as the params props. By default,\n * this object is:\n *\n * { filter: {}, order: null, page: 1, perPage: null, sort: null }\n *\n * To check if the user has custom params, we must compare the params\n * to these initial values.\n *\n * @param {Object} params\n */\nexport var hasCustomParams = function (params) {\n    return (params &&\n        params.filter &&\n        (Object.keys(params.filter).length > 0 ||\n            params.order != null ||\n            params.page !== 1 ||\n            params.perPage != null ||\n            params.sort != null));\n};\n/**\n * Merge list params from 3 different sources:\n *   - the query string\n *   - the params stored in the state (from previous navigation)\n *   - the props passed to the List component (including the filter defaultValues)\n */\nexport var getQuery = function (_a) {\n    var queryFromLocation = _a.queryFromLocation, params = _a.params, filterDefaultValues = _a.filterDefaultValues, sort = _a.sort, perPage = _a.perPage;\n    var query = Object.keys(queryFromLocation).length > 0\n        ? queryFromLocation\n        : hasCustomParams(params)\n            ? __assign({}, params) : { filter: filterDefaultValues || {} };\n    if (!query.sort) {\n        query.sort = sort.field;\n        query.order = sort.order;\n    }\n    if (query.perPage == null) {\n        query.perPage = perPage;\n    }\n    if (query.page == null) {\n        query.page = 1;\n    }\n    return __assign(__assign({}, query), { page: getNumberOrDefault(query.page, 1), perPage: getNumberOrDefault(query.perPage, 10) });\n};\nexport var getNumberOrDefault = function (possibleNumber, defaultValue) {\n    var parsedNumber = typeof possibleNumber === 'string'\n        ? parseInt(possibleNumber, 10)\n        : possibleNumber;\n    return isNaN(parsedNumber) ? defaultValue : parsedNumber;\n};\nexport default useListParams;\n"]},"metadata":{},"sourceType":"module"}