{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __spreadArrays = this && this.__spreadArrays || function () {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n\n  for (var r = Array(s), k = 0, i = 0; i < il; i++) for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) r[k] = a[j];\n\n  return r;\n};\n\nimport { useCallback } from 'react';\nimport useGetList from '../../dataProvider/useGetList';\nimport { getStatusForInput as getDataStatus } from './referenceDataStatus';\nimport useTranslate from '../../i18n/useTranslate';\nimport useReference from '../useReference';\nimport usePaginationState from '../usePaginationState';\nimport { useSortState } from '..';\nimport useFilterState from '../useFilterState';\nimport useSelectionState from '../useSelectionState';\nimport { useResourceContext } from '../../core';\n\nvar defaultReferenceSource = function (resource, source) {\n  return resource + \"@\" + source;\n};\n\nvar defaultFilter = {};\n/**\n * A hook for choosing a reference record. Useful for foreign keys.\n *\n * This hook fetches the possible values in the reference resource\n * (using `dataProvider.getList()`), it returns the possible choices\n * as the `choices` attribute.\n *\n * @example\n * const {\n *      choices, // the available reference resource\n * } = useReferenceInputController({\n *      input, // the input props\n *      resource: 'comments',\n *      reference: 'posts',\n *      source: 'post_id',\n * });\n *\n * The hook also allow to filter results. It returns a `setFilter`\n * function. It uses the value to create a filter\n * for the query - by default { q: [searchText] }. You can customize the mapping\n * searchText => searchQuery by setting a custom `filterToQuery` function option\n * You can also add a permanentFilter to further filter the result:\n *\n * @example\n * const {\n *      choices, // the available reference resource\n *      setFilter,\n * } = useReferenceInputController({\n *      input, // the input props\n *      resource: 'comments',\n *      reference: 'posts',\n *      source: 'post_id',\n *      permanentFilter: {\n *          author: 'john'\n *      },\n *      filterToQuery: searchText => ({ title: searchText })\n * });\n */\n\nexport var useReferenceInputController = function (props) {\n  var _a;\n\n  var basePath = props.basePath,\n      input = props.input,\n      _b = props.page,\n      initialPage = _b === void 0 ? 1 : _b,\n      _c = props.perPage,\n      initialPerPage = _c === void 0 ? 25 : _c,\n      _d = props.filter,\n      filter = _d === void 0 ? defaultFilter : _d,\n      reference = props.reference,\n      filterToQuery = props.filterToQuery,\n      sortOverride = props.sort;\n  var resource = useResourceContext(props);\n  var translate = useTranslate(); // pagination logic\n\n  var _e = usePaginationState({\n    page: initialPage,\n    perPage: initialPerPage\n  }),\n      pagination = _e.pagination,\n      setPagination = _e.setPagination,\n      page = _e.page,\n      setPage = _e.setPage,\n      perPage = _e.perPage,\n      setPerPage = _e.setPerPage; // sort logic\n\n\n  var _f = useSortState(sortOverride),\n      sort = _f.sort,\n      setSortObject = _f.setSort;\n\n  var setSort = useCallback(function (field, order) {\n    if (order === void 0) {\n      order = 'ASC';\n    }\n\n    setSortObject({\n      field: field,\n      order: order\n    });\n    setPage(1);\n  }, [setPage, setSortObject]); // filter logic\n\n  var _g = useFilterState({\n    permanentFilter: filter,\n    filterToQuery: filterToQuery\n  }),\n      filterValues = _g.filter,\n      setFilter = _g.setFilter;\n\n  var displayedFilters = []; // plus showFilter and hideFilter defined outside of the hook because\n  // they never change\n  // selection logic\n\n  var _h = useSelectionState(),\n      selectedIds = _h.selectedIds,\n      onSelect = _h.onSelect,\n      onToggleItem = _h.onToggleItem,\n      onUnselectItems = _h.onUnselectItems; // fetch possible values\n\n\n  var _j = useGetList(reference, pagination, sort, filterValues),\n      possibleValuesIds = _j.ids,\n      possibleValuesData = _j.data,\n      possibleValuesTotal = _j.total,\n      possibleValuesLoaded = _j.loaded,\n      possibleValuesLoading = _j.loading,\n      possibleValuesError = _j.error; // fetch current value\n\n\n  var _k = useReference({\n    id: input.value,\n    reference: reference\n  }),\n      referenceRecord = _k.referenceRecord,\n      referenceError = _k.error,\n      referenceLoading = _k.loading,\n      referenceLoaded = _k.loaded; // add current value to possible sources\n\n\n  var finalIds, finalData, finalTotal;\n\n  if (!referenceRecord || possibleValuesIds.includes(input.value)) {\n    finalIds = possibleValuesIds;\n    finalData = possibleValuesData;\n    finalTotal = possibleValuesTotal;\n  } else {\n    finalIds = __spreadArrays([input.value], possibleValuesIds);\n    finalData = __assign((_a = {}, _a[input.value] = referenceRecord, _a), possibleValuesData);\n    finalTotal = possibleValuesTotal + 1;\n  } // overall status\n\n\n  var dataStatus = getDataStatus({\n    input: input,\n    matchingReferences: Object.keys(finalData).map(function (id) {\n      return finalData[id];\n    }),\n    referenceRecord: referenceRecord,\n    translate: translate\n  });\n  return {\n    // should match the ListContext shape\n    possibleValues: {\n      basePath: basePath,\n      data: finalData,\n      ids: finalIds,\n      total: finalTotal,\n      error: possibleValuesError,\n      loaded: possibleValuesLoaded,\n      loading: possibleValuesLoading,\n      hasCreate: false,\n      page: page,\n      setPage: setPage,\n      perPage: perPage,\n      setPerPage: setPerPage,\n      currentSort: sort,\n      setSort: setSort,\n      filterValues: filterValues,\n      displayedFilters: displayedFilters,\n      setFilters: setFilter,\n      showFilter: showFilter,\n      hideFilter: hideFilter,\n      selectedIds: selectedIds,\n      onSelect: onSelect,\n      onToggleItem: onToggleItem,\n      onUnselectItems: onUnselectItems,\n      resource: resource\n    },\n    referenceRecord: {\n      data: referenceRecord,\n      loaded: referenceLoaded,\n      loading: referenceLoading,\n      error: referenceError\n    },\n    dataStatus: {\n      error: dataStatus.error,\n      loading: dataStatus.waiting,\n      warning: dataStatus.warning\n    },\n    choices: finalIds.map(function (id) {\n      return finalData[id];\n    }),\n    // kept for backwards compatibility\n    // @deprecated to be removed in 4.0\n    error: dataStatus.error,\n    loading: possibleValuesLoading || referenceLoading,\n    loaded: possibleValuesLoaded && referenceLoaded,\n    filter: filterValues,\n    setFilter: setFilter,\n    pagination: pagination,\n    setPagination: setPagination,\n    sort: sort,\n    setSort: setSortObject,\n    warning: dataStatus.warning\n  };\n};\n\nvar hideFilter = function () {};\n\nvar showFilter = function () {};","map":{"version":3,"sources":["/node_modules/ra-core/esm/controller/input/useReferenceInputController.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__spreadArrays","il","r","Array","k","a","j","jl","useCallback","useGetList","getStatusForInput","getDataStatus","useTranslate","useReference","usePaginationState","useSortState","useFilterState","useSelectionState","useResourceContext","defaultReferenceSource","resource","source","defaultFilter","useReferenceInputController","props","_a","basePath","input","_b","page","initialPage","_c","perPage","initialPerPage","_d","filter","reference","filterToQuery","sortOverride","sort","translate","_e","pagination","setPagination","setPage","setPerPage","_f","setSortObject","setSort","field","order","_g","permanentFilter","filterValues","setFilter","displayedFilters","_h","selectedIds","onSelect","onToggleItem","onUnselectItems","_j","possibleValuesIds","ids","possibleValuesData","data","possibleValuesTotal","total","possibleValuesLoaded","loaded","possibleValuesLoading","loading","possibleValuesError","error","_k","id","value","referenceRecord","referenceError","referenceLoading","referenceLoaded","finalIds","finalData","finalTotal","includes","dataStatus","matchingReferences","keys","map","possibleValues","hasCreate","currentSort","setFilters","showFilter","hideFilter","waiting","warning","choices"],"mappings":"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","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nimport { useCallback } from 'react';\nimport useGetList from '../../dataProvider/useGetList';\nimport { getStatusForInput as getDataStatus } from './referenceDataStatus';\nimport useTranslate from '../../i18n/useTranslate';\nimport useReference from '../useReference';\nimport usePaginationState from '../usePaginationState';\nimport { useSortState } from '..';\nimport useFilterState from '../useFilterState';\nimport useSelectionState from '../useSelectionState';\nimport { useResourceContext } from '../../core';\nvar defaultReferenceSource = function (resource, source) {\n    return resource + \"@\" + source;\n};\nvar defaultFilter = {};\n/**\n * A hook for choosing a reference record. Useful for foreign keys.\n *\n * This hook fetches the possible values in the reference resource\n * (using `dataProvider.getList()`), it returns the possible choices\n * as the `choices` attribute.\n *\n * @example\n * const {\n *      choices, // the available reference resource\n * } = useReferenceInputController({\n *      input, // the input props\n *      resource: 'comments',\n *      reference: 'posts',\n *      source: 'post_id',\n * });\n *\n * The hook also allow to filter results. It returns a `setFilter`\n * function. It uses the value to create a filter\n * for the query - by default { q: [searchText] }. You can customize the mapping\n * searchText => searchQuery by setting a custom `filterToQuery` function option\n * You can also add a permanentFilter to further filter the result:\n *\n * @example\n * const {\n *      choices, // the available reference resource\n *      setFilter,\n * } = useReferenceInputController({\n *      input, // the input props\n *      resource: 'comments',\n *      reference: 'posts',\n *      source: 'post_id',\n *      permanentFilter: {\n *          author: 'john'\n *      },\n *      filterToQuery: searchText => ({ title: searchText })\n * });\n */\nexport var useReferenceInputController = function (props) {\n    var _a;\n    var basePath = props.basePath, input = props.input, _b = props.page, initialPage = _b === void 0 ? 1 : _b, _c = props.perPage, initialPerPage = _c === void 0 ? 25 : _c, _d = props.filter, filter = _d === void 0 ? defaultFilter : _d, reference = props.reference, filterToQuery = props.filterToQuery, sortOverride = props.sort;\n    var resource = useResourceContext(props);\n    var translate = useTranslate();\n    // pagination logic\n    var _e = usePaginationState({ page: initialPage, perPage: initialPerPage }), pagination = _e.pagination, setPagination = _e.setPagination, page = _e.page, setPage = _e.setPage, perPage = _e.perPage, setPerPage = _e.setPerPage;\n    // sort logic\n    var _f = useSortState(sortOverride), sort = _f.sort, setSortObject = _f.setSort;\n    var setSort = useCallback(function (field, order) {\n        if (order === void 0) { order = 'ASC'; }\n        setSortObject({ field: field, order: order });\n        setPage(1);\n    }, [setPage, setSortObject]);\n    // filter logic\n    var _g = useFilterState({\n        permanentFilter: filter,\n        filterToQuery: filterToQuery,\n    }), filterValues = _g.filter, setFilter = _g.setFilter;\n    var displayedFilters = [];\n    // plus showFilter and hideFilter defined outside of the hook because\n    // they never change\n    // selection logic\n    var _h = useSelectionState(), selectedIds = _h.selectedIds, onSelect = _h.onSelect, onToggleItem = _h.onToggleItem, onUnselectItems = _h.onUnselectItems;\n    // fetch possible values\n    var _j = useGetList(reference, pagination, sort, filterValues), possibleValuesIds = _j.ids, possibleValuesData = _j.data, possibleValuesTotal = _j.total, possibleValuesLoaded = _j.loaded, possibleValuesLoading = _j.loading, possibleValuesError = _j.error;\n    // fetch current value\n    var _k = useReference({\n        id: input.value,\n        reference: reference,\n    }), referenceRecord = _k.referenceRecord, referenceError = _k.error, referenceLoading = _k.loading, referenceLoaded = _k.loaded;\n    // add current value to possible sources\n    var finalIds, finalData, finalTotal;\n    if (!referenceRecord || possibleValuesIds.includes(input.value)) {\n        finalIds = possibleValuesIds;\n        finalData = possibleValuesData;\n        finalTotal = possibleValuesTotal;\n    }\n    else {\n        finalIds = __spreadArrays([input.value], possibleValuesIds);\n        finalData = __assign((_a = {}, _a[input.value] = referenceRecord, _a), possibleValuesData);\n        finalTotal = possibleValuesTotal + 1;\n    }\n    // overall status\n    var dataStatus = getDataStatus({\n        input: input,\n        matchingReferences: Object.keys(finalData).map(function (id) { return finalData[id]; }),\n        referenceRecord: referenceRecord,\n        translate: translate,\n    });\n    return {\n        // should match the ListContext shape\n        possibleValues: {\n            basePath: basePath,\n            data: finalData,\n            ids: finalIds,\n            total: finalTotal,\n            error: possibleValuesError,\n            loaded: possibleValuesLoaded,\n            loading: possibleValuesLoading,\n            hasCreate: false,\n            page: page,\n            setPage: setPage,\n            perPage: perPage,\n            setPerPage: setPerPage,\n            currentSort: sort,\n            setSort: setSort,\n            filterValues: filterValues,\n            displayedFilters: displayedFilters,\n            setFilters: setFilter,\n            showFilter: showFilter,\n            hideFilter: hideFilter,\n            selectedIds: selectedIds,\n            onSelect: onSelect,\n            onToggleItem: onToggleItem,\n            onUnselectItems: onUnselectItems,\n            resource: resource,\n        },\n        referenceRecord: {\n            data: referenceRecord,\n            loaded: referenceLoaded,\n            loading: referenceLoading,\n            error: referenceError,\n        },\n        dataStatus: {\n            error: dataStatus.error,\n            loading: dataStatus.waiting,\n            warning: dataStatus.warning,\n        },\n        choices: finalIds.map(function (id) { return finalData[id]; }),\n        // kept for backwards compatibility\n        // @deprecated to be removed in 4.0\n        error: dataStatus.error,\n        loading: possibleValuesLoading || referenceLoading,\n        loaded: possibleValuesLoaded && referenceLoaded,\n        filter: filterValues,\n        setFilter: setFilter,\n        pagination: pagination,\n        setPagination: setPagination,\n        sort: sort,\n        setSort: setSortObject,\n        warning: dataStatus.warning,\n    };\n};\nvar hideFilter = function () { };\nvar showFilter = function () { };\n"]},"metadata":{},"sourceType":"module"}